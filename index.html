<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Doolin Coast Guard SAR Call Out Toolkit</title>
<style>
body {
font-family: Arial, sans-serif;
background: url('background.jpg') no-repeat center center fixed;
background-size: cover;
color: #fff;
text-align: center;
margin: 0;
padding: 0;
}

h1 {
background: rgba(0, 0, 0, 0.6);
padding: 20px;
font-size: 3em;
}

.container {
display: flex;
flex-direction: column;
justify-content: center;
align-items: center;
gap: 40px;
margin: 20px auto;
max-width: 1200px;
}

.widget {
background: rgba(0, 0, 0, 0.65);
padding: 30px;
border-radius: 15px;
width: 90%;
max-width: 800px;
font-size: 1.8em;
text-align: left;
}

.widget h2 {
margin-top: 0;
font-size: 2em;
text-align: center;
}

select, button {
font-size: 1.5em;
padding: 10px;
margin: 10px;
}
</style>
</head>
<body>
<h1>Doolin Coast Guard SAR Call Out Toolkit</h1>

<div>
<label for="location">Choose a location: </label>
<select id="location">
<option value="DOOLIN">Doolin</option>
<option value="KILKEE">Kilkee</option>
<option value="LAHINCH">Lahinch</option>
<option value="SPANISH_POINT">Spanish Point</option>
<option value="KINVARA">Kinvara</option>
<option value="GALWAY">Galway</option>
<option value="TRALEE">Tralee</option>
<option value="DINGLE">Dingle</option>
</select>
<button onclick="updateData()">Update</button>
</div>

<div class="container">
<div class="widget">
<h2>Weather</h2>
<div id="weatherData">Loading...</div>
</div>

<div class="widget">
<h2>Tides</h2>
<div id="tideData">Loading...</div>
</div>

<div class="widget">
<h2>SAR News</h2>
<div id="newsData">Loading...</div>
</div>
</div>

<script>
// ðŸ‘‡ replace with your deployed Cloudflare Worker URL
const proxy = "https://doolin-sar-proxy.michellemarypurcell.workers.dev/?url=";

const stationLookup = {
"DOOLIN": { tide: "GALWAY_PORT", weather: "SHANNON_AIRPORT" },
"KILKEE": { tide: "KILRUSH", weather: "SHANNON_AIRPORT" },
"LAHINCH": { tide: "GALWAY_PORT", weather: "SHANNON_AIRPORT" },
"SPANISH_POINT": { tide: "KILRUSH", weather: "SHANNON_AIRPORT" },
"KINVARA": { tide: "GALWAY_PORT", weather: "GALWAY_AIRPORT" },
"GALWAY": { tide: "GALWAY_PORT", weather: "GALWAY_AIRPORT" },
"TRALEE": { tide: "FENIT", weather: "VALENTIA_OBSERVATORY" },
"DINGLE": { tide: "VALENTIA", weather: "VALENTIA_OBSERVATORY" }
};

async function updateData() {
const loc = document.getElementById("location").value;
const station = stationLookup[loc];

// WEATHER
try {
const weatherUrl = proxy + encodeURIComponent(`https://prodapi.metweb.ie/observations/${station.weather}`);
const w = await fetch(weatherUrl);
const weather = await w.json();
document.getElementById("weatherData").innerHTML = `
<strong>${station.weather}</strong><br>
Temp: ${weather.report.temperature} Â°C<br>
Wind: ${weather.report.wind_speed} kt (${weather.report.wind_direction_text})<br>
Gusts: ${weather.report.wind_gust} kt<br>
Pressure: ${weather.report.pressure} hPa
`;
} catch (e) {
document.getElementById("weatherData").textContent = "Error fetching weather.";
}

// TIDES
try {
const tideUrl = proxy + encodeURIComponent(
`https://erddap.marine.ie/erddap/tabledap/I_NATIONAL_TIDE_GAUGE_NETWORK.json?station_id,sea_surface_height,time&station_id="${station.tide}"&time>=now&time<=now+12hours`
);
const t = await fetch(tideUrl);
const tides = await t.json();
const rows = tides.table.rows.map(r => {
const [id, height, time] = r;
return `<li>${new Date(time).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})} â€” ${height.toFixed(2)} m</li>`;
}).join("");
document.getElementById("tideData").innerHTML = `<strong>${station.tide}</strong><br><ul style="list-style:none; padding:0">${rows}</ul>`;
} catch (e) {
document.getElementById("tideData").textContent = "Error fetching tides.";
}

// SAR NEWS
try {
const newsUrl = proxy + encodeURIComponent("https://news.google.com/rss/search?q=Irish+Coast+Guard+SAR&hl=en-IE&gl=IE&ceid=IE:en");
const n = await fetch(newsUrl);
const text = await n.text();
const parser = new DOMParser();
const xml = parser.parseFromString(text, "text/xml");
const items = xml.querySelectorAll("item");
let html = "<ul style='list-style:none; padding:0'>";
items.forEach((item, idx) => {
if (idx < 5) {
html += `<li><a href="${item.querySelector("link").textContent}" target="_blank" style="color:#fff">${item.querySelector("title").textContent}</a></li>`;
}
});
html += "</ul>";
document.getElementById("newsData").innerHTML = html;
} catch (e) {
document.getElementById("newsData").textContent = "Error fetching news.";
}
}

// Auto-refresh every 60s
setInterval(updateData, 60000);
window.onload = updateData;
</script>
</body>
</html>
