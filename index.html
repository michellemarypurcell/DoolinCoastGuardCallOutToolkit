<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Doolin Coast Guard Call-out OPs</title>
<style>
  body{margin:0;font-family:Arial, sans-serif;background:#0b0b0b;color:#fff}
  header{padding:12px;background:#222;text-align:center}
  h1{margin:0}
  #sarIncident{background:#b00;color:#fff;padding:16px;margin:10px;border-radius:10px;text-align:center}
  #adminPanel{display:none;background:#600;padding:14px;margin:10px;border-radius:10px}
  #infoBar{background:#111;padding:8px;display:flex;justify-content:space-between;flex-wrap:wrap}
  main{display:flex;gap:20px;padding:10px}
  .panel{flex:1;background:#222;padding:12px;border-radius:8px}
  footer{text-align:center;padding:12px;background:#111;position:relative}
  #adminLink{cursor:pointer;color:#0af;font-size:0.9rem}
</style>
</head>
<body>
<header>
  <h1>Doolin Coast Guard Call-out OPs</h1>
</header>

<section id="sarIncident">
  <h2>Latest Coast Guard Incident</h2>
  <div id="incidentDetails"><p>No active incident entered.</p></div>
</section>

<div id="adminPanel">
  <h3>Admin Input â€“ Coast Guard Incident</h3>
  <label>Incident # <input id="incNum"></label><br>
  <label>Title <input id="incTitle"></label><br>
  <label>Summary <input id="incSummary"></label><br>
  <label>Location <input id="incLoc"></label><br>
  <button onclick="saveIncident()">Save</button>
</div>

<div id="infoBar">
  <div><strong id="locName">Doolin Port</strong></div>
  <div>
    <label for="locationSelect">Location:</label>
    <select id="locationSelect"></select>
  </div>
</div>

<main>
  <div class="panel">
    <h2>Weather</h2>
    <div id="weatherData">Loadingâ€¦</div>
  </div>
  <div class="panel">
    <h2>Tides</h2>
    <div id="tideData">Loadingâ€¦</div>
  </div>
</main>

<footer>
  <span id="latestData">Latest data as of: --</span><br>
  <span id="adminLink" onclick="goAdmin()">ðŸ”’ Admin Login</span>
</footer>

<script>
/* Admin login */
function goAdmin(){ window.location.search='?admin=1'; }
if(window.location.search.includes("admin=1")){
  document.getElementById("adminPanel").style.display="block";
}

/* Incident store */
function loadIncident(){
  const data=JSON.parse(localStorage.getItem("cgIncident")||"{}");
  if(data && data.title){
    document.getElementById("incidentDetails").innerHTML=
      `<strong>Incident #${data.num}:</strong> ${data.title}<br>
       ${data.summary}<br><em>Location: ${data.loc}</em>`;
  }
}
function saveIncident(){
  const data={
    num:document.getElementById("incNum").value,
    title:document.getElementById("incTitle").value,
    summary:document.getElementById("incSummary").value,
    loc:document.getElementById("incLoc").value
  };
  localStorage.setItem("cgIncident",JSON.stringify(data));
  loadIncident();
}
loadIncident();

/* Locations */
const LOCS={
  "DOOLIN":{name:"Doolin Port",lat:53.016,lon:-9.4,station:"Inishmore"},
  "KILKEE":{name:"Kilkee",lat:52.678,lon:-9.644,station:"Kilrush"}
};
const sel=document.getElementById("locationSelect");
for(const [id,l] of Object.entries(LOCS)){
  const o=document.createElement("option");
  o.value=id;o.textContent=l.name;
  if(id==="DOOLIN") o.selected=true;
  sel.appendChild(o);
}
let CUR=LOCS["DOOLIN"];
sel.onchange=()=>{CUR=LOCS[sel.value];updateAll();};

/* Weather + Tides (simplified) */
async function updateAll(){
  document.getElementById("locName").textContent=CUR.name;
  document.getElementById("latestData").textContent=
    "Latest data as of: "+new Date().toLocaleTimeString();
  try{
    const w=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${CUR.lat}&longitude=${CUR.lon}&current_weather=true`);
    const j=await w.json();
    document.getElementById("weatherData").textContent=
      `${j.current_weather.temperature}Â°C, ${j.current_weather.windspeed} km/h`;
  }catch{document.getElementById("weatherData").textContent="Error";}

  try{
    const now=new Date();
    const s=now.toISOString().split('.')[0]+"Z";
    const e=new Date(now.getTime()+6*3600e3).toISOString().split('.')[0]+"Z";
    const url=`https://erddap.marine.ie/erddap/tabledap/TidePrediction.json?station_id,sea_surface_height,time&station_id=${CUR.station}&time>=${s}&time<=${e}`;
    const t=await fetch(url); const j=await t.json();
    document.getElementById("tideData").textContent=
      j.table?.rows?.map(r=>`${r[2]} â†’ ${r[1]}m`).join(" | ") || "No data";
  }catch{document.getElementById("tideData").textContent="Error";}
}
updateAll();
</script>
</body>
</html>
