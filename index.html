<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Doolin Coast Guard SAR Call Out Toolkit</title>
<style>
body {
font-family: Arial, sans-serif;
background: url('background.jpg') no-repeat center center fixed;
background-size: cover;
color: #fff;
text-align: center;
margin: 0;
padding: 0;
}

h1 {
background: rgba(0, 0, 0, 0.6);
padding: 20px;
font-size: 3em;
}

.container {
display: flex;
flex-direction: column;
justify-content: center;
align-items: center;
gap: 40px;
margin: 20px auto;
max-width: 1200px;
}

.widget {
background: rgba(0, 0, 0, 0.65);
padding: 40px;
border-radius: 15px;
width: 90%;
max-width: 900px;
font-size: 1.8em;
text-align: left;
}

.widget h2 {
margin-top: 0;
font-size: 2.2em;
text-align: center;
}

label {
font-weight: bold;
font-size: 1.6em;
}

select, button {
font-size: 1.4em;
padding: 10px;
margin: 10px;
}

#status {
margin-top: 10px;
font-size: 1.2em;
font-style: italic;
}

#debug {
position: fixed;
bottom: 0;
left: 0;
width: 100%;
background: rgba(0,0,0,0.7);
color: #0f0;
font-size: 0.8em;
text-align: left;
padding: 5px;
max-height: 150px;
overflow:auto;
}
</style>
</head>
<body>
<h1>Doolin Coast Guard SAR Call Out Toolkit</h1>

<div>
<label for="location">Change location:</label>
<select id="location">
<option value="DOOLIN" selected>Doolin Port</option>
<option value="KILKEE">Kilkee</option>
<option value="LAHINCH">Lahinch</option>
<option value="SPANISH_POINT">Spanish Point</option>
<option value="KINVARA">Kinvara</option>
<option value="GALWAY">Galway</option>
<option value="TRALEE">Tralee</option>
<option value="DINGLE">Dingle</option>
</select>
<button onclick="updateData()">Update</button>
<div id="status">Loading...</div>
</div>

<div class="container">
<div class="widget">
<h2>Weather</h2>
<div id="weatherData">Loading...</div>
</div>

<div class="widget">
<h2>Tides</h2>
<div id="tideData">Loading...</div>
</div>

<div class="widget">
<h2>SAR News</h2>
<div id="newsData">Loading...</div>
</div>
</div>

<div id="debug"></div>

<script>
// Cloudflare Worker proxy endpoint
const proxy = "https://doolin-sar-proxy.michellemarypurcell.workers.dev/?url=";

// Location → station lookup
const stationLookup = {
"DOOLIN": { tide: "GALWAY_PORT", weather: "SHANNON_AIRPORT" },
"KILKEE": { tide: "KILRUSH", weather: "SHANNON_AIRPORT" },
"LAHINCH": { tide: "GALWAY_PORT", weather: "SHANNON_AIRPORT" },
"SPANISH_POINT": { tide: "KILRUSH", weather: "SHANNON_AIRPORT" },
"KINVARA": { tide: "GALWAY_PORT", weather: "GALWAY_AIRPORT" },
"GALWAY": { tide: "GALWAY_PORT", weather: "GALWAY_AIRPORT" },
"TRALEE": { tide: "FENIT", weather: "VALENTIA_OBSERVATORY" },
"DINGLE": { tide: "VALENTIA", weather: "VALENTIA_OBSERVATORY" }
};

async function updateData() {
const loc = document.getElementById("location").value;
const station = stationLookup[loc];
const debugDiv = document.getElementById("debug");
debugDiv.innerHTML = "";

// status with timestamp
const now = new Date();
document.getElementById("status").innerHTML =
`Currently showing: <b>${loc}</b> (Last updated: ${now.toLocaleString()})`;

// WEATHER
try {
const weatherUrl = proxy + encodeURIComponent(`https://prodapi.metweb.ie/observations/${station.weather}`);
debugDiv.innerHTML += `<div>Fetching weather: ${weatherUrl}</div>`;
const w = await fetch(weatherUrl);
const weather = await w.json();
document.getElementById("weatherData").innerHTML = `
<strong>${station.weather}</strong><br>
Temp: ${weather.report.temperature} °C<br>
Wind: ${weather.report.wind_speed} kt (${weather.report.wind_direction_text})<br>
Gusts: ${weather.report.wind_gust} kt<br>
Pressure: ${weather.report.pressure} hPa
`;
} catch (e) {
document.getElementById("weatherData").textContent = "Error fetching weather.";
debugDiv.innerHTML += `<div style="color:red">Weather error: ${e}</div>`;
}

// TIDES
try {
const tideUrl = proxy + encodeURIComponent(
`https://erddap.marine.ie/erddap/tabledap/I_NATIONAL_TIDE_GAUGE_NETWORK.json?station_id,sea_surface_height,time&station_id="${station.tide}"&time>=now&time<=now+12hours`
);
debugDiv.innerHTML += `<div>Fetching tides: ${tideUrl}</div>`;
const t = await fetch(tideUrl);
const tides = await t.json();
const rows = tides.table.rows.map(r => {
const [id, height, time] = r;
return `<li>${new Date(time).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})} — ${height.toFixed(2)} m</li>`;
}).join("");
document.getElementById("tideData").innerHTML =
`<strong>${station.tide}</strong><br><ul style="list-style:none; padding:0">${rows}</ul>`;
} catch (e) {
document.getElementById("tideData").textContent = "Error fetching tides.";
debugDiv.innerHTML += `<div style="color:red">Tide error: ${e}</div>`;
}

// SAR NEWS
try {
const newsUrl = proxy + encodeURIComponent("https://news.google.com/rss/search?q=Irish+Coast+Guard+SAR&hl=en-IE&gl=IE&ceid=IE:en");
debugDiv.innerHTML += `<div>Fetching news: ${newsUrl}</div>`;
const n = await fetch(newsUrl);
const text = await n.text();
const parser = new DOMParser();
const xml = parser.parseFromString(text, "text/xml");
const items = xml.querySelectorAll("item");
let html = "<ul style='list-style:none; padding:0'>";
items.forEach((item, idx) => {
if (idx < 5) {
html += `<li><a href="${item.querySelector("link").textContent}" target="_blank" style="color:#fff">${item.querySelector("title").textContent}</a></li>`;
}
});
html += "</ul>";
document.getElementById("newsData").innerHTML = html;
} catch (e) {
document.getElementById("newsData").textContent = "Error fetching news.";
debugDiv.innerHTML += `<div style="color:red">News error: ${e}</div>`;
}
}

// Auto-refresh every 60s
setInterval(updateData, 60000);
window.onload = updateData;
</script>
</body>
</html>

